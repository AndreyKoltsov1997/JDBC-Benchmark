#!groovy

def SUCCESS_MESSAGE_OUTPUT_COLOR = '\033[1;32m'
def FAILURE_MESSAGE_OUTPUT_COLOR = '\033[0;31m'

final EMPTY_COMMIT_TAG = "empty_commit_tag"
final DEFAULT_IMAGE_TAG = "latest"

pipeline {
    /* The agent directive, which is required, instructs Jenkins to allocate an executor and workspace for the Pipeline */        
    // NOTE: Using different agent on different jobs 
    agent any

    stages {
        stage("YAML file tests") {
            steps {
                script {
                    sh "ls"
                    final String dir = System.getProperty("user.dir");
                    echo "current file's dir: $dir"
                    String currentDirectory = new File(".").getAbsolutePath();
                    echo "Current directory: $currentDirectory"
                    File yaml = new File("test.yaml")
                    echo "Current YAML file: $yaml.text";

                    def newCountry = "USA";
                    yaml.text = yaml.text.replaceFirst(/country: '.*'/, "country: '${newCountry}'")
                    echo "Updated YAML file: $yaml.text"
                }
            }
        }
    }
    post {
        failure {
            script {
                // NOTE: In case job in step 1 has failed, it executes AFTER all the other jobs.
                echo "Caught failure."
            }
        }
    }
}
